"0","##use Tilia calls to assemble list of samples"
"0","if (exists(""samples.ti"")) {if (checkRecent(samples.ti) == F) {rm(samples.ti)}}"
"2","Warning: no non-missing arguments to max; returning -Inf"
"0","require(httr);require(jsonlite);require(dplyr);require(rlist)"
"0","if (!exists(""samples.ti"")) {"
"0","  samples.ti <- vector(mode = ""list"",length = nrow(vert_and_chron))"
"0","  print(paste0(c(""Downloading geochron sample data for"",nrow(vert_and_chron),""datasets...""),collapse = "" ""))"
"0","  I <- 1; J <- 100"
"0","  while (I <= nrow(vert_and_chron)){"
"0","    for (i in I:J) {"
"0","      temp <- get_from_tilia(values = vert_and_chron$datasetid[i], "
"0","                             params = ""datasetid"", "
"0","                             meth = ""getgeochronanalysisunitsbydatasetid"")$data"
"0","      if (length(temp) == 0) { temp <- data.frame(sampleid = NA,collectionunitid = NA,"
"0","                                                 analysisunitid = NA,analysisunitname = NA,"
"0","                                                 depth = NA,thickness = NA) }"
"0","      samples.ti[[i]] <- data.frame(datasetid = vert_and_chron$datasetid[i], temp)"
"0","    }"
"0","    save(samples.ti,file = here(""data/samples_ti_temp.RData""))"
"0","    if (i %% 1000 == 0) {print(paste0(c(i,""downloaded""),collapse="" ""))}"
"0","    I <- i + 1; J <- i + 100"
"0","    if (J > nrow(vert_and_chron)) {J <- nrow(vert_and_chron)} "
"0","  }"
"0","  print(paste0(c(""Done."",length(which(sapply(samples.ti,function(x) is.na(x$sampleid[1])))),""of"",length(samples.ti),""failed.""),collapse = "" ""))"
"0","  #getting sampleid and analysisunitid by datasetid"
"0","} #run time: ~15 minutes"
"1","[1]"
"1"," ""Downloading geochron sample data for 5464 datasets..."""
"1","
"
"1","[1]"
"1"," ""1000 downloaded"""
"1","
"
"1","[1]"
"1"," ""2000 downloaded"""
"1","
"
"1","[1]"
"1"," ""3000 downloaded"""
"1","
"
"1","[1]"
"1"," ""4000 downloaded"""
"1","
"
"1","[1]"
"1"," ""5000 downloaded"""
"1","
"
"1","[1]"
"1"," ""Done. 5 of 5464 failed."""
"1","
"
"0","samples.ids <- distinct(list.stack(samples.ti)[, c(""datasetid"", ""sampleid"", ""analysisunitid"")])"
"0","samples.ids <- subset(samples.ids,!is.na(samples.ids$sampleid))"
